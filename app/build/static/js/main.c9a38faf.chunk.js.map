{"version":3,"sources":["cam/cam.module.css","WebAssembly_Logo.svg","cam/index.tsx","App.tsx","reportWebVitals.js","index.js"],"names":["module","exports","Cam","canvas","useRef","video","sobelButton","useEffect","current","effect","addEventListener","ctx","wasm","pointer","lastTime","Infinity","ticks","then","native","navigator","mediaDevices","getUserMedia","stream","getContext","srcObject","drawToCanvas","Date","getTime","catch","err0r","console","log","time","width","videoWidth","height","videoHeight","drawImage","byteSize","alloc","imageData","getImageData","b1","data","buffer","b2","memory","Uint8Array","byteLength","set","sobel","Uint8ClampedArray","imageDataUpdated","ImageData","putImageData","fps","toFixed","document","querySelector","innerHTML","requestAnimationFrame","className","css","flex","sideDiv","buttonList","ref","hide","autoPlay","App","src","logo","alt","id","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.c9a38faf.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"hide\":\"cam_hide__3ofNy\",\"flex\":\"cam_flex__22L5-\",\"sideDiv\":\"cam_sideDiv__1_1lG\",\"buttonList\":\"cam_buttonList__TsgiK\"};","export default __webpack_public_path__ + \"static/media/WebAssembly_Logo.1381587b.svg\";","import {useEffect, useRef, useState} from \"react\";\nimport css from './cam.module.css'\n\nfunction Cam() {\n    let canvas = useRef<HTMLCanvasElement>(null)\n    let video = useRef<HTMLVideoElement>(null)\n    let sobelButton = useRef<HTMLButtonElement>(null)\n\n\n    useEffect(() => {\n        if (canvas === null) return;\n        if (video.current === null) return;\n        if (sobelButton.current === null) return;\n\n        let effect = 0;\n\n        sobelButton.current.addEventListener(\"click\", () => {\n            effect = effect === 1 ? 0 : 1\n        })\n\n        let ctx: CanvasRenderingContext2D | null,\n            // @ts-ignore\n            wasm,\n            pointer = -1,\n            lastTime = Infinity,\n            ticks = 0;\n\n        function memcopy(b1: ArrayBufferLike, b2: SharedArrayBuffer, offset: number) {\n            new Uint8Array(b2, offset, b1.byteLength).set(new Uint8Array(b1));\n        }\n\n        function drawToCanvas(time: number) {\n            if (video.current && canvas.current) {\n                const width = video.current.videoWidth;\n                const height = video.current.videoHeight;\n                canvas.current.width = width;\n                canvas.current.height = height;\n\n                ctx?.drawImage(video.current, 0, 0, width, height);\n                if (effect === 1) {\n                    if (canvas.current.width > 0) {\n                        if (canvas.current && pointer === -1) {\n                            canvas.current.width = width;\n                            canvas.current.height = height;\n                            const byteSize = width * height * 4;\n                            // @ts-ignore\n                            pointer = wasm.alloc(byteSize);\n                        } else if (canvas.current && ctx) {\n                            let imageData = ctx.getImageData(0, 0, width, height);\n                            //@ts-ignore\n                            memcopy(imageData.data.buffer, wasm.memory.buffer, pointer)\n                            //@ts-ignore\n                            wasm.sobel(pointer, width, height)\n                            //@ts-ignore\n                            const data = new Uint8ClampedArray(wasm.memory.buffer, pointer, width * height * 4);\n                            const imageDataUpdated = new ImageData(data, width, height);\n                            ctx.putImageData(imageDataUpdated, 0, 0)\n                        }\n                    }\n                }\n                if (ticks % 5 === 0) {\n                    let fps = (1000 / (time - lastTime)).toFixed(2);\n                    //@ts-ignore\n                    document.querySelector(\"#fps\").innerHTML = fps;\n                }\n                ticks += 1;\n                if (ticks > 5) ticks = 0;\n                lastTime = time;\n                requestAnimationFrame(drawToCanvas)\n            }\n        }\n\n        import('../wasm')\n            .then(native => {\n                wasm = native;\n                if (navigator.mediaDevices.getUserMedia) {\n                    navigator.mediaDevices.getUserMedia({ video: true })\n                        .then(function (stream) {\n                            if (canvas.current !== null) {\n                                ctx = canvas.current.getContext('2d');\n                            }\n                            if (video.current) {\n                                video.current.srcObject = stream;\n                            }\n\n                            drawToCanvas(new Date().getTime())\n                        })\n                        .catch(function (err0r) {\n                            console.log(\"Something went wrong!\");\n                        });\n                }\n            })\n    }, [sobelButton, video, canvas])\n\n    return (\n        <div className={css.flex}>\n            <div className={css.sideDiv}>\n                <ul className={css.buttonList}>\n                    <button ref={sobelButton}>Sobel Edge Detection</button>\n                </ul>\n            </div>\n            <canvas ref={canvas} > </canvas>\n            <video className={css.hide} autoPlay={true} ref={video} />\n            <div className={css.sideDiv}></div>\n        </div>\n    );\n}\n\nexport default Cam;\n","import logo from './WebAssembly_Logo.svg';\nimport './App.css';\nimport {useEffect} from \"react\";\nimport Cam from \"./cam\";\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\n        <p>\n          Cam effects with <code>wasm</code> and <code>rust</code> <span id={\"fps\"}></span>fps\n        </p>\n\n          <Cam />\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}