{"version":3,"sources":["cam/cam.module.css","cam/worker.ts","WebAssembly_Logo.svg","cam/cam.ts","cam/index.tsx","App.tsx","reportWebVitals.js","index.js"],"names":["module","exports","addMethods","methods","w","Worker","name","Cam","canvas","video","sobelButton","boxBlurButton","sharpenButton","embossButton","laplacianButton","current","ctx","lastTime","Infinity","ticks","effect","workers","workersFinished","width","height","memory","WebAssembly","Memory","initial","maximum","shared","addEventListener","navigator","mediaDevices","getUserMedia","then","stream","getContext","srcObject","i","hardwareConcurrency","workerInstance","worker","workerMesageRecieved","loadWasm","push","createWorkers","catch","console","log","drawToCanvas","time","document","querySelector","innerHTML","toFixed","drawFps","videoWidth","videoHeight","drawImage","requestAnimationFrame","b1","b2","imageData","getImageData","data","buffer","Uint8Array","byteLength","set","length","box_blur","message","type","loaded","Date","getTime","workerFinished","Uint8ClampedArray","imageDataUpdated","ImageData","putImageData","useRef","useEffect","cam","className","css","flex","sideDiv","buttonList","ref","hide","autoPlay","App","src","logo","alt","id","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.09b46374.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"hide\":\"cam_hide__3ykpy\",\"flex\":\"cam_flex__2nGjf\",\"sideDiv\":\"cam_sideDiv__2z-E5\",\"buttonList\":\"cam_buttonList__28TZE\"};","\n\t\t\t\tvar addMethods = require(\"../../node_modules/workerize-loader/dist/rpc-wrapper.js\")\n\t\t\t\tvar methods = [\"box_blur\",\"loadWasm\",\"allocateImageMemory\"]\n\t\t\t\tmodule.exports = function() {\n\t\t\t\t\tvar w = new Worker(__webpack_public_path__ + \"17c88039e3680da16bfb.worker.js\", { name: \"[hash].worker.js\" })\n\t\t\t\t\taddMethods(w, methods)\n\t\t\t\t\t\n\t\t\t\t\treturn w\n\t\t\t\t}\n\t\t\t","export default __webpack_public_path__ + \"static/media/WebAssembly_Logo.1381587b.svg\";","import React from \"react\";\n//@ts-ignore\nimport worker from 'workerize-loader!./worker'; // eslint-disable-line import/no-webpack-loader-syntax\nimport {Wasm} from './camera';\n\nexport default function Cam(\n    canvas: React.RefObject<HTMLCanvasElement>,\n    video: React.RefObject<HTMLVideoElement>,\n    sobelButton: React.RefObject<HTMLButtonElement>,\n    boxBlurButton: React.RefObject<HTMLButtonElement>,\n    sharpenButton: React.RefObject<HTMLButtonElement>,\n    embossButton: React.RefObject<HTMLButtonElement>,\n    laplacianButton: React.RefObject<HTMLButtonElement>\n) {\n    if (canvas.current === null) return;\n    if (video.current === null) return;\n    if (sobelButton.current === null) return;\n    if (boxBlurButton.current === null) return;\n    if (sharpenButton.current === null) return;\n    if (embossButton.current === null) return;\n    if (laplacianButton.current === null) return;\n\n    let ctx: CanvasRenderingContext2D | null,\n        pointer = -1,\n        lastTime = Infinity,\n        ticks = 0,\n        effect = 0,\n        workers: Wasm[] = [],\n        workersFinished = 0,\n        width = 0,\n        height = 0,\n        numJobs = 0,\n        memory = new WebAssembly.Memory({\n            initial: 80,\n            maximum: 80,\n            //@ts-ignore\n            shared: true\n        });\n\n    function drawToCanvas(time: number) {\n        if (!(video.current && canvas.current)) return;\n        drawFps(time)\n        width = video.current.videoWidth;\n        height = video.current.videoHeight;\n        canvas.current.width = width;\n        canvas.current.height = height;\n        // draw webcam to canvas\n        ctx?.drawImage(video.current, 0, 0, width, height);\n        // do we have no effect selected? is the canvas ready?\n        if (effect === 0 || !(width > 0 && canvas.current && ctx)) return requestAnimationFrame(drawToCanvas)\n        // get image data from the canvas\n        const imageData = ctx.getImageData(0, 0, width, height);\n        memcopy(imageData.data.buffer, memory.buffer, pointer)\n        switch (effect) {\n            case 2:\n                for(let i = 0; i < workers.length; i++) {\n                    workers[i].box_blur(pointer, width, height, i, navigator.hardwareConcurrency)\n                }\n                break;\n        }\n    }\n\n    function workerMesageRecieved(message: MessageEvent) {\n        if (message.data.type) return;\n\n        if (message.data.loaded && workersFinished === navigator.hardwareConcurrency - 1) {\n            workersFinished = 0;\n            drawToCanvas(new Date().getTime())\n        } else if (message.data.loaded) {\n            workersFinished += 1;\n        } else if (message.data.workerFinished && workersFinished === navigator.hardwareConcurrency - 1) {\n            console.log(\"workers are all finished\")\n            workersFinished = 0;\n            const data = new Uint8ClampedArray(memory.buffer, pointer, width * height * 4);\n            const imageDataUpdated = new ImageData(data, width, height);\n            ctx?.putImageData(imageDataUpdated, 0, 0)\n\n            requestAnimationFrame(drawToCanvas)\n        } else if (message.data.workerFinished) {\n            workersFinished += 1;\n        }\n    }\n\n    function createWorkers() {\n        for (let i = 0; i < navigator.hardwareConcurrency; i++) {\n            const workerInstance = worker()\n            workerInstance.addEventListener('message', workerMesageRecieved)\n            workerInstance.loadWasm(memory)\n            workers.push(workerInstance)\n        }\n    }\n\n    function camLoaded(stream: MediaStream) {\n        if (canvas.current !== null) {\n            ctx = canvas.current.getContext('2d');\n        }\n        if (video.current) {\n            video.current.srcObject = stream;\n        }\n\n        createWorkers()\n    }\n\n    function memcopy(b1: ArrayBufferLike, b2: ArrayBuffer, offset: number) {\n        new Uint8Array(b2, offset, b1.byteLength).set(new Uint8Array(b1));\n    }\n\n    function drawFps(time: number) {\n        if (ticks % 5 === 0) {\n            //@ts-ignore\n            document.querySelector(\"#fps\").innerHTML = (1000 / (time - lastTime)).toFixed(2);\n        }\n        ticks += 1;\n        if (ticks > 5) ticks = 0;\n        lastTime = time;\n    }\n\n    sobelButton.current.addEventListener(\"click\", () => {\n        effect = effect === 1 ? 0 : 1\n    })\n\n    boxBlurButton.current.addEventListener(\"click\", () => {\n        effect = effect === 2 ? 0 : 2\n    })\n\n    sharpenButton.current.addEventListener(\"click\", () => {\n        effect = effect === 3 ? 0 : 3\n    })\n\n    embossButton.current.addEventListener(\"click\", () => {\n        effect = effect === 4 ? 0 : 4\n    })\n\n    laplacianButton.current.addEventListener(\"click\", () => {\n        effect = effect === 5 ? 0 : 5\n    })\n\n    if (navigator.mediaDevices.getUserMedia) {\n        navigator.mediaDevices.getUserMedia({video: true})\n            .then(camLoaded)\n            .catch(function () {\n                console.log(\"Something went wrong!\");\n            });\n    }\n}\n","import {useEffect, useRef} from \"react\";\nimport css from './cam.module.css'\nimport cam from './cam'\n\nfunction Cam() {\n    const canvas = useRef<HTMLCanvasElement>(null)\n    const video = useRef<HTMLVideoElement>(null)\n    const sobelButton = useRef<HTMLButtonElement>(null)\n    const boxBlurButton = useRef<HTMLButtonElement>(null)\n    const sharpenButton = useRef<HTMLButtonElement>(null)\n    const embossButton = useRef<HTMLButtonElement>(null)\n    const laplacianButton = useRef<HTMLButtonElement>(null)\n\n\n    useEffect(() => cam(canvas, video, sobelButton, boxBlurButton, sharpenButton, embossButton, laplacianButton),\n        [sobelButton, video, canvas])\n\n    return (\n        <div className={css.flex}>\n            <div className={css.sideDiv}>\n                <ul className={css.buttonList}>\n                    <li><button ref={sobelButton}>Sobel Edge Detection</button></li>\n                    <li><button ref={boxBlurButton}>Box Blur</button></li>\n                    <li><button ref={sharpenButton}>Sharpen</button></li>\n                    <li><button ref={embossButton}>Emboss</button></li>\n                    <li><button ref={laplacianButton}>Laplacian</button></li>\n                </ul>\n            </div>\n            <canvas ref={canvas} > </canvas>\n            <video className={css.hide} autoPlay={true} ref={video} />\n            <div className={css.sideDiv}></div>\n        </div>\n    );\n}\n\nexport default Cam;\n","import logo from './WebAssembly_Logo.svg';\nimport './App.css';\nimport Cam from \"./cam\";\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\n        <p>\n          Cam effects with <code>wasm</code> and <code>rust</code> <span id={\"fps\"}></span>fps\n        </p>\n\n          <Cam />\n      </header>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}